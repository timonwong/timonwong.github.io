<!doctype html><html><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>RabbitMQ笔记（一）: 通过Vagrant建立一个RabbitMQ服务器实验环境 - Timon Wong</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="安装Vagrant 在官方网站上，下载并安装Vagrant
NOTE: Vagrant 1.6版本对CentOS的guest支持不好，不能正确设置网络连接，需要升级到最新版或打上下面这个补丁: Fix issue reported at mitchellh#3649
下载并导入CentOS 6.3 Box vagrant box add --name centos63 'https://s3.amazonaws.com/itmat-public/centos-6.3-chef-10.14.2.box' 创建Vagrantfile Vagrantfile 文件内容如下:
# -*- mode: ruby -*- # vi: set ft=ruby : # Vagrantfile API/syntax version. Don't touch unless you know what you're doing! VAGRANTFILE_API_VERSION = &#34;2&#34; Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = &#34;centos63&#34; # 一个Host-Only的Network, IP地址可以自定义, 方便访问 config.vm.network :private_network, ip: &#34;10.10.0.70&#34;, netmask: &#34;255.255.255.0&#34; # config.vm.synced_folder &#34;../&#34;, &#34;/vagrant&#34; config.vm.provider :virtualbox do |vb| # 调节虚拟机CPU个数 vb.">
<meta property="og:image" content>
<meta property="og:title" content="RabbitMQ笔记（一）: 通过Vagrant建立一个RabbitMQ服务器实验环境">
<meta property="og:description" content="安装Vagrant 在官方网站上，下载并安装Vagrant
NOTE: Vagrant 1.6版本对CentOS的guest支持不好，不能正确设置网络连接，需要升级到最新版或打上下面这个补丁: Fix issue reported at mitchellh#3649
下载并导入CentOS 6.3 Box vagrant box add --name centos63 'https://s3.amazonaws.com/itmat-public/centos-6.3-chef-10.14.2.box' 创建Vagrantfile Vagrantfile 文件内容如下:
# -*- mode: ruby -*- # vi: set ft=ruby : # Vagrantfile API/syntax version. Don't touch unless you know what you're doing! VAGRANTFILE_API_VERSION = &#34;2&#34; Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = &#34;centos63&#34; # 一个Host-Only的Network, IP地址可以自定义, 方便访问 config.vm.network :private_network, ip: &#34;10.10.0.70&#34;, netmask: &#34;255.255.255.0&#34; # config.vm.synced_folder &#34;../&#34;, &#34;/vagrant&#34; config.vm.provider :virtualbox do |vb| # 调节虚拟机CPU个数 vb.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://theo.im/blog/2014/05/13/rabbitmq-note-1-setup-experimental-rabbitmq-environment-using-vagrant/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2014-05-13T14:46:31+00:00">
<meta property="article:modified_time" content="2014-05-13T14:46:31+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="RabbitMQ笔记（一）: 通过Vagrant建立一个RabbitMQ服务器实验环境">
<meta name=twitter:description content="安装Vagrant 在官方网站上，下载并安装Vagrant
NOTE: Vagrant 1.6版本对CentOS的guest支持不好，不能正确设置网络连接，需要升级到最新版或打上下面这个补丁: Fix issue reported at mitchellh#3649
下载并导入CentOS 6.3 Box vagrant box add --name centos63 'https://s3.amazonaws.com/itmat-public/centos-6.3-chef-10.14.2.box' 创建Vagrantfile Vagrantfile 文件内容如下:
# -*- mode: ruby -*- # vi: set ft=ruby : # Vagrantfile API/syntax version. Don't touch unless you know what you're doing! VAGRANTFILE_API_VERSION = &#34;2&#34; Vagrant.configure(VAGRANTFILE_API_VERSION) do |config| config.vm.box = &#34;centos63&#34; # 一个Host-Only的Network, IP地址可以自定义, 方便访问 config.vm.network :private_network, ip: &#34;10.10.0.70&#34;, netmask: &#34;255.255.255.0&#34; # config.vm.synced_folder &#34;../&#34;, &#34;/vagrant&#34; config.vm.provider :virtualbox do |vb| # 调节虚拟机CPU个数 vb.">
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://theo.im/css/main.2f9b5946627215dc1ae7fa5f82bfc9cfcab000329136befeea5733f21e77d68f.css>
<link rel=stylesheet type=text/css href=https://theo.im/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)">
</head>
<body>
<div class=content><header>
<div class=main>
<a href=https://theo.im/>Timon Wong</a>
</div>
<nav>
<a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a>
</nav>
</header>
<main>
<article>
<div class=title>
<h1 class=title>RabbitMQ笔记（一）: 通过Vagrant建立一个RabbitMQ服务器实验环境</h1>
<div class=meta>Posted on May 13, 2014</div>
</div>
<section class=body>
<h2 id=安装vagrant>安装Vagrant</h2>
<p>在<a href=http://vagrantup.com>官方网站</a>上，下载并安装Vagrant</p>
<p><strong>NOTE</strong>: Vagrant 1.6版本对<code>CentOS</code>的guest支持不好，不能正确设置网络连接，需要升级到最新版或打上下面这个补丁: <a href=https://github.com/cammoraton/vagrant/commit/1e4584cde51765972af41cd48fc0409756a8fd59>Fix issue reported at mitchellh#3649</a></p>
<h2 id=下载并导入centos-63-box>下载并导入CentOS 6.3 Box</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vagrant box add --name centos63 <span style=color:#e6db74>&#39;https://s3.amazonaws.com/itmat-public/centos-6.3-chef-10.14.2.box&#39;</span>
</code></pre></div><h2 id=创建vagrantfile>创建Vagrantfile</h2>
<p><code>Vagrantfile</code> 文件内容如下:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#75715e># -*- mode: ruby -*-</span>
<span style=color:#75715e># vi: set ft=ruby :</span>

<span style=color:#75715e># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
<span style=color:#66d9ef>VAGRANTFILE_API_VERSION</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2&#34;</span>

<span style=color:#66d9ef>Vagrant</span><span style=color:#f92672>.</span>configure(<span style=color:#66d9ef>VAGRANTFILE_API_VERSION</span>) <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>config<span style=color:#f92672>|</span>
  config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>box <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;centos63&#34;</span>

  <span style=color:#75715e># 一个Host-Only的Network, IP地址可以自定义, 方便访问</span>
  config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>network <span style=color:#e6db74>:private_network</span>, <span style=color:#e6db74>ip</span>: <span style=color:#e6db74>&#34;10.10.0.70&#34;</span>, <span style=color:#e6db74>netmask</span>: <span style=color:#e6db74>&#34;255.255.255.0&#34;</span>

  <span style=color:#75715e># config.vm.synced_folder &#34;../&#34;, &#34;/vagrant&#34;</span>

  config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>provider <span style=color:#e6db74>:virtualbox</span> <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>vb<span style=color:#f92672>|</span>
    <span style=color:#75715e># 调节虚拟机CPU个数</span>
    vb<span style=color:#f92672>.</span>customize <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;modifyvm&#34;</span>, <span style=color:#e6db74>:id</span>, <span style=color:#e6db74>&#34;--cpus&#34;</span>, <span style=color:#e6db74>&#34;2&#34;</span><span style=color:#f92672>]</span>
    <span style=color:#75715e># 调节虚拟机内存大小</span>
    vb<span style=color:#f92672>.</span>customize <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;modifyvm&#34;</span>, <span style=color:#e6db74>:id</span>, <span style=color:#e6db74>&#34;--memory&#34;</span>, <span style=color:#e6db74>&#34;2048&#34;</span><span style=color:#f92672>]</span>
    vb<span style=color:#f92672>.</span>customize <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;modifyvm&#34;</span>, <span style=color:#e6db74>:id</span>, <span style=color:#e6db74>&#34;--natdnshostresolver1&#34;</span>, <span style=color:#e6db74>&#34;on&#34;</span><span style=color:#f92672>]</span>
    vb<span style=color:#f92672>.</span>customize <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;setextradata&#34;</span>, <span style=color:#e6db74>:id</span>, <span style=color:#e6db74>&#34;VBoxInternal2/SharedFoldersEnableSymlinksCreate/vagrant&#34;</span>, <span style=color:#e6db74>&#34;1&#34;</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>end</span>

  <span style=color:#75715e># 自动安装脚本</span>
  config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>provision <span style=color:#e6db74>:shell</span>, <span style=color:#e6db74>path</span>: <span style=color:#e6db74>&#34;provision.sh&#34;</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>为了简化安装，提供一个用于自动安装的脚本<code>provision.sh</code>，文件内容如下：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/usr/bin/env bash
</span><span style=color:#75715e></span>
<span style=color:#75715e># Disable yum fastestmirror plugin</span>
sed -i.backup <span style=color:#e6db74>&#39;s/^enabled=1/enabled=0/&#39;</span> /etc/yum/pluginconf.d/fastestmirror.conf
<span style=color:#75715e># Change yum mirror (163)</span>
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
wget -O /etc/yum.repos.d/CentOS-Base-163.repo http://mirrors.163.com/.help/CentOS6-Base-163.repo
yum makecache
yum update

<span style=color:#75715e># Install EPEL repository</span>
wget http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
rpm -Uvh remi-release-6*.rpm epel-release-6*.rpm

<span style=color:#75715e># Install and start rabbitmq-server</span>
yum -y install rabbitmq-server

<span style=color:#75715e>## Automatically start</span>
chkconfig rabbitmq-server on

<span style=color:#75715e>## Create a sample config and enable guest user remote access</span>
echo &gt; /etc/rabbitmq/rabbitmq.config <span style=color:#e6db74>&lt;&lt;EOF
</span><span style=color:#e6db74>[
</span><span style=color:#e6db74>  {rabbit, [
</span><span style=color:#e6db74>    {loopback_users, []}
</span><span style=color:#e6db74>  ]}
</span><span style=color:#e6db74>].
</span><span style=color:#e6db74>EOF</span>

<span style=color:#75715e>## Enable magement plugin</span>
/usr/lib/rabbitmq/bin/rabbitmq-plugins enable rabbitmq_management

<span style=color:#75715e>## Start rabbitmq-server</span>
service rabbitmq-server start

<span style=color:#75715e># Disable iptables</span>
service iptables stop
chkconfig iptables off

</code></pre></div><h2 id=启动虚拟机>启动虚拟机</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vagrant up
</code></pre></div><h2 id=使用ssh连接到虚拟机>使用SSH连接到虚拟机</h2>
<p>使用命令(如果支持的话):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vagrant ssh
</code></pre></div><p>或使用SSH工具，例如 <a href=http://www.netsarang.com/products/xsh_overview.html>XShell</a>, <a href=http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html>PuTTY</a> 等工具，连接到 <code>10.10.0.70:22</code> (IP在之前 <code>Vagrantfile</code> 中定义)</p>
<h2 id=停止虚拟机>停止虚拟机</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vagrant halt
</code></pre></div>
</section>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/rabbitmq>RabbitMQ</a></li>
<li><a href=/tags/vagrant>Vagrant</a></li>
</ul>
</nav>
</div>
</article>
</main>
<footer>
<hr><a class=soc href=https://github.com/timonwong title=GitHub><i data-feather=github></i></a>|⚡️
2021 © timonwong | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a>
</footer>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-35644871-2','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script>feather.replace()</script></div>
</body>
</html>