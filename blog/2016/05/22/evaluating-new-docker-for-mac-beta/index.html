<!doctype html><html><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>试用最新的 Docker for Mac Beta - Timon Wong</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="DEPRECATION: 现在 Docker for Mac 已经可以通过界面配置 mirror 了，这片文章作废
如何申请 Docker for Mac Beta 请访问这个地址申请，可能需要等几天：https://beta.docker.com/
Docker for Mac Beta，最大的好处就是不再依赖 VirtualBox VM 了，而是使用了更轻量化的 xhyve 作为其虚拟化方案（也即是说，仍然不是原生的，还是需要虚拟化一个 Linux 出来在上面运行 Docker Daemon）。
另外，这个版本的 Docker for Mac 使用了 Alpine Linux 发行版，作为一个更轻量化的发行版，与一般的发行版有不少区别，比如，使用 ash 替换 bash 等，具体请访问 Alpine Linux 网站获取更多信息。
使用 Docker Hub Registry Mirror 由于众所周知的原因，在国内访问 Docker Hub 的速度相当缓慢，因此需要设置一个 Docker Registry Mirror 来加速，这里使用 USTC 的 Docker Hub Mirror。
就如同之前所说，Alpine Linux 发行版与一般发行版有巨大区别，因此调整 Docker Daemon 的启动参数也不大一样😂
Quick Way NOTE: 安装了 jq 命令行工具（可以通过 brew install jq 安装），可以直接执行一行命令行搞定，否则请参阅「Slow Way」一节：">
<meta property="og:image" content>
<meta property="og:title" content="试用最新的 Docker for Mac Beta">
<meta property="og:description" content="DEPRECATION: 现在 Docker for Mac 已经可以通过界面配置 mirror 了，这片文章作废
如何申请 Docker for Mac Beta 请访问这个地址申请，可能需要等几天：https://beta.docker.com/
Docker for Mac Beta，最大的好处就是不再依赖 VirtualBox VM 了，而是使用了更轻量化的 xhyve 作为其虚拟化方案（也即是说，仍然不是原生的，还是需要虚拟化一个 Linux 出来在上面运行 Docker Daemon）。
另外，这个版本的 Docker for Mac 使用了 Alpine Linux 发行版，作为一个更轻量化的发行版，与一般的发行版有不少区别，比如，使用 ash 替换 bash 等，具体请访问 Alpine Linux 网站获取更多信息。
使用 Docker Hub Registry Mirror 由于众所周知的原因，在国内访问 Docker Hub 的速度相当缓慢，因此需要设置一个 Docker Registry Mirror 来加速，这里使用 USTC 的 Docker Hub Mirror。
就如同之前所说，Alpine Linux 发行版与一般发行版有巨大区别，因此调整 Docker Daemon 的启动参数也不大一样😂
Quick Way NOTE: 安装了 jq 命令行工具（可以通过 brew install jq 安装），可以直接执行一行命令行搞定，否则请参阅「Slow Way」一节：">
<meta property="og:type" content="article">
<meta property="og:url" content="https://theo.im/blog/2016/05/22/evaluating-new-docker-for-mac-beta/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2016-05-22T21:47:02+00:00">
<meta property="article:modified_time" content="2016-05-22T21:47:02+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="试用最新的 Docker for Mac Beta">
<meta name=twitter:description content="DEPRECATION: 现在 Docker for Mac 已经可以通过界面配置 mirror 了，这片文章作废
如何申请 Docker for Mac Beta 请访问这个地址申请，可能需要等几天：https://beta.docker.com/
Docker for Mac Beta，最大的好处就是不再依赖 VirtualBox VM 了，而是使用了更轻量化的 xhyve 作为其虚拟化方案（也即是说，仍然不是原生的，还是需要虚拟化一个 Linux 出来在上面运行 Docker Daemon）。
另外，这个版本的 Docker for Mac 使用了 Alpine Linux 发行版，作为一个更轻量化的发行版，与一般的发行版有不少区别，比如，使用 ash 替换 bash 等，具体请访问 Alpine Linux 网站获取更多信息。
使用 Docker Hub Registry Mirror 由于众所周知的原因，在国内访问 Docker Hub 的速度相当缓慢，因此需要设置一个 Docker Registry Mirror 来加速，这里使用 USTC 的 Docker Hub Mirror。
就如同之前所说，Alpine Linux 发行版与一般发行版有巨大区别，因此调整 Docker Daemon 的启动参数也不大一样😂
Quick Way NOTE: 安装了 jq 命令行工具（可以通过 brew install jq 安装），可以直接执行一行命令行搞定，否则请参阅「Slow Way」一节：">
<script src=https://theo.im/js/feather.min.js></script>
<link href=https://theo.im/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://theo.im/css/main.2f9b5946627215dc1ae7fa5f82bfc9cfcab000329136befeea5733f21e77d68f.css>
</head>
<body>
<div class=content><header>
<div class=main>
<a href=https://theo.im/>Timon Wong</a>
</div>
<nav>
<a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/tags>Tags</a>
</nav>
</header>
<main>
<article>
<div class=title>
<h1 class=title>试用最新的 Docker for Mac Beta</h1>
<div class=meta>Posted on May 22, 2016</div>
</div>
<section class=body>
<p>DEPRECATION: 现在 Docker for Mac 已经可以通过界面配置 mirror 了，这片文章作废</p>
<h2 id=如何申请-docker-for-mac-beta>如何申请 Docker for Mac Beta</h2>
<p>请访问这个地址申请，可能需要等几天：https://beta.docker.com/</p>
<p>Docker for Mac Beta，最大的好处就是不再依赖 VirtualBox VM 了，而是使用了更轻量化的 <a href=https://github.com/mist64/xhyve>xhyve</a> 作为其虚拟化方案（也即是说，仍然不是原生的，还是需要虚拟化一个 Linux 出来在上面运行 Docker Daemon）。</p>
<p>另外，这个版本的 Docker for Mac 使用了 <a href=http://alpinelinux.org/>Alpine Linux</a> 发行版，作为一个更轻量化的发行版，与一般的发行版有不少区别，比如，使用 <code>ash</code> 替换 <code>bash</code> 等，具体请访问 <a href=http://alpinelinux.org/>Alpine Linux</a> 网站获取更多信息。</p>
<h2 id=使用-docker-hub-registry-mirror>使用 Docker Hub Registry Mirror</h2>
<p>由于众所周知的原因，在国内访问 Docker Hub 的速度相当缓慢，因此需要设置一个 Docker Registry Mirror 来加速，这里使用 <a href=https://servers.ustclug.org/2015/05/new-docker-hub-registry-mirror/>USTC 的 Docker Hub Mirror</a>。</p>
<p>就如同之前所说，<a href=http://alpinelinux.org/>Alpine Linux</a> 发行版与一般发行版有巨大区别，因此调整 Docker Daemon 的启动参数也不大一样😂</p>
<h3 id=quick-way>Quick Way</h3>
<p><strong>NOTE:</strong> 安装了 <code>jq</code> 命令行工具（可以通过 <code>brew install jq</code> 安装），可以直接执行一行命令行搞定，否则请参阅「Slow Way」一节：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pinata get daemon | jq -cM <span style=color:#e6db74>&#39;.&#34;registry-mirrors&#34; = [&#34;https://docker.mirrors.ustc.edu.cn&#34;]&#39;</span> | pinata set daemon -
</code></pre></div><h3 id=slow-way>Slow Way</h3>
<h4 id=1-导出当前的设置>1. 导出当前的设置</h4>
<p>运行以下命令，将当前设置保存到 <code>docker-config.json</code> 文件中：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pinata get daemon &gt; docker-config.json
<span style=color:#75715e>## &gt;&gt; {&#34;storage-driver&#34;:&#34;aufs&#34;,&#34;debug&#34;:true}</span>
</code></pre></div><h4 id=2-使用文本编辑器编辑设置>2. 使用文本编辑器编辑设置</h4>
<p>使用任何一种文本编辑器，打开 <code>docker-config.json</code> 并按照 <code>JSON</code> 格式编辑为以下内容，然后保存并退出：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;storage-driver&#34;</span>:<span style=color:#e6db74>&#34;aufs&#34;</span>,<span style=color:#f92672>&#34;debug&#34;</span>:<span style=color:#66d9ef>true</span>,<span style=color:#f92672>&#34;registry-mirrors&#34;</span>:[<span style=color:#e6db74>&#34;https://docker.mirrors.ustc.edu.cn&#34;</span>]}
</code></pre></div><h4 id=3-加载最新设置>3. 加载最新设置</h4>
<p>最后，加载 <code>docker-config.json</code> 中的设置就可以了：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>pinata</span> <span style=color:#960050;background-color:#1e0010>set</span> <span style=color:#960050;background-color:#1e0010>daemon</span> <span style=color:#960050;background-color:#1e0010>@docker-config.json</span>
</code></pre></div><h2 id=获取-docker-guest-的-ip-地址>获取 Docker Guest 的 IP 地址</h2>
<p>有时候，我们需要得到 Docker Guest 的 IP 地址，其实不大有比较快捷的方法，比如，先运行 <code>pinata get network</code>，居然返回这个？？WTF？！</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>hostnet
</code></pre></div><p>然后只有运行 <code>pinata list</code> 了：</p>
<pre><code>These are advanced configuration settings to customise Docker.app on MacOSX.
You can set them via pinata set &lt;key&gt; &lt;value&gt; &lt;options&gt;.

🐳  hostname = docker
   Hostname of the virtual machine endpoint, where container ports will be
   exposed if using nat networking. Access it via 'docker.local'.

🐳  hypervisor = native (memory=2, ncpu=2)
   The Docker.app includes embedded hypervisors that run the virtual machines
   that power the containers. This setting allows you to control which the
   default one used for Linux is.

 ▸  native: a version of the xhyve hypervisor that uses the MacOSX
              Hypervisor.framework to run container VMs. Parameters:
              memory (VM memory in gigabytes), ncpu (vCPUs)


🐳  network = hostnet (docker-ipv4=192.168.65.2, host-ipv4=192.168.65.1)
   Controls how local containers can access the external network via the
   MacOS X host. This includes outbound traffic as well as publishing ports
   for external access to the local containers.

 ▸ hostnet: a mode that helps if you are using a VPN that restricts
              connectivity. Activating this mode will proxy container network
              packets via the Docker.app process as host socket traffic.
              Parameters: docker-ipv4 (docker node), host-ipv4 (host node)
 ▸     nat: a mode that uses the MacOS X vmnet.framework to route container
              traffic to the host network via a NAT.

🐳  filesystem = osxfs
   Controls the mode by which files from the MacOS X host and the container
   filesystem are shared with each other.

 ▸   osxfs: a FUSE-based filesystem that bidirectionally forwards OSX
              filesystem events into the container.


🐳  native/port-forwarding = true
   Expose container ports on the Mac, rather than the VM

 ▸    true: Container ports will be exposed on the Mac
 ▸   false: Container ports will be exposed on the VM

🐳  daemon = run 'pinata get daemon' or 'pinata set daemon [@file|-]&gt;
   JSON configuration of the local Docker daemon. Configure any custom
   options you need as documented in:
   https://docs.docker.com/engine/reference/commandline/daemon/. Set it
   directly, or a @file or - for stdin.
</code></pre>
<p>因此看起来使用 <code>pinata list | grep 'network ='</code> 才是合理的方式之一：</p>
<pre><code>*  network = hostnet (docker-ipv4=192.168.65.2, host-ipv4=192.168.65.1)
</code></pre>
<p>以上</p>
</section>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/docker>Docker</a></li>
<li><a href=/tags/osx>OSX</a></li>
</ul>
</nav>
</div>
</article>
</main>
<footer>
<hr><a class=soc href=https://github.com/timonwong title=GitHub><i data-feather=github></i></a>|⚡️
2021 © timonwong | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a>
</footer>
<script>feather.replace()</script></div>
</body>
</html>